<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>给宝宝的小情书(◕ᴗ◕✿)</title>
<style>
  /* --- 1. 全局基础 --- */
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body {
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background: radial-gradient(circle at center, #1a1c29 0%, #050505 100%);
    font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
    position: relative;
    user-select: none;
  }

  /* --- 2. 烟花画布 --- */
  #fireworksCanvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1; 
    pointer-events: none;
  }

  /* --- 3. 弹窗样式 --- */
  .window-card {
    position: fixed;
    width: 110px;
    background: rgba(18, 18, 20, 0.85);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1.5px solid #fff; 
    border-radius: 12px;
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.1);
    /* 动画：加入一点回弹效果 */
    transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.5s, top 0.8s, left 0.8s;
    z-index: 10;
    display: flex;
    flex-direction: column;
    box-shadow: 0 4px 20px rgba(0,0,0,0.6);
    overflow: hidden;
  }

  .card-header {
    height: 24px;
    background: rgba(255, 255, 255, 0.08);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .header-icon { font-size: 10px; margin-right: 4px; }
  .close-btn { 
    font-size: 14px; color: rgba(255,255,255,0.6); 
    cursor: pointer; line-height: 1; padding: 5px;
  }

  .card-body {
    padding: 10px;
    font-size: 11px;
    color: #eee;
    line-height: 1.5;
    text-align: left;
    min-height: 45px;
    display: flex;
    align-items: center;
    pointer-events: none; 
  }

  /* 状态类 */
  .window-card.show {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }

  .window-card.active {
    z-index: 99999 !important;
    transform: translate(-50%, -50%) scale(1.6) !important;
    background: rgba(10, 10, 10, 0.98);
    border-width: 2px;
    box-shadow: 0 0 30px rgba(255,255,255,0.3);
  }

  .window-card.dragging {
    transition: none;
    z-index: 100000 !important;
  }

  /* --- 4. 悬浮菜单按钮组 (右下角) --- */
  .fab-container {
    position: fixed;
    bottom: 40px;
    right: 30px;
    z-index: 200000;
    display: flex;
    flex-direction: column-reverse;
    align-items: center;
    gap: 15px;
  }

  /* 主按钮 */
  .main-fab {
    width: 55px;
    height: 55px;
    background: linear-gradient(135deg, #ff9a9e 0%, #ff6a88 100%);
    border-radius: 50%;
    box-shadow: 0 5px 20px rgba(255, 106, 136, 0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 24px;
    color: white;
    cursor: pointer;
    transition: transform 0.3s;
    border: 2px solid #fff;
    animation: heartBeat 2s infinite;
  }
  
  @keyframes heartBeat {
    0% { transform: scale(1); }
    15% { transform: scale(1.1); }
    30% { transform: scale(1); }
    45% { transform: scale(1.1); }
    60% { transform: scale(1); }
    100% { transform: scale(1); }
  }

  .menu-items {
    display: flex;
    flex-direction: column;
    gap: 15px;
    opacity: 0;
    pointer-events: none;
    transform: translateY(20px);
    transition: all 0.4s;
  }

  .fab-container.expanded .menu-items {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }
  
  .fab-container.expanded .main-fab {
    animation: none;
    transform: rotate(45deg);
  }

  /* 功能按钮 */
  .action-btn {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
    border: 2px solid;
    color: #fff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-size: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    transition: transform 0.2s;
  }
  
  .action-btn:active { transform: scale(0.9); }
  .btn-icon { font-size: 18px; margin-bottom: 2px; }

  .btn-start { border-color: #00ffcc; color: #00ffcc; text-shadow: 0 0 5px #00ffcc; }
  .btn-scatter { border-color: #ffa500; color: #ffa500; text-shadow: 0 0 5px #ffa500; }
  .btn-clear { border-color: #ff4d4d; color: #ff4d4d; text-shadow: 0 0 5px #ff4d4d; }

</style>
</head>
<body>

<canvas id="fireworksCanvas"></canvas>

<!-- 音乐：这里放了一个备用网络链接，防止你没有本地文件导致报错 -->
<audio id="bgMusic" loop>
  <source src="岳燃-慢慢.mp3" type="audio/mpeg">
  <!-- 备用链接，如果没有本地文件会自动用这个 -->
  <source src="https://music.163.com/song/media/outer/url?id=1901371647.mp3" type="audio/mpeg">
</audio>

<div class="fab-container" id="fabContainer">
  <div class="menu-items">
    <div class="action-btn btn-clear" onclick="clearAll()">
      <span class="btn-icon">×</span>
      <span>清除</span>
    </div>
    <div class="action-btn btn-scatter" onclick="scatterCards()">
      <span class="btn-icon">✨</span>
      <span>散落</span>
    </div>
    <div class="action-btn btn-start" onclick="startShow()">
      <span class="btn-icon">▶</span>
      <span>开始</span>
    </div>
  </div>
  <div class="main-fab" onclick="toggleMenu()">❤</div>
</div>

<script>
// --- 1. 文案库 ---
const textData = [
  "慢慢的习惯身边有你的温暖", "晚安，梦里见", "今天有没有一点点想我", "天气变凉了，记得加衣", "不仅要早睡，还要睡得香",
  "想和你分享今天发生的趣事", "你现在的表情是不是很可爱", "刚才看到一个背影好像你", "你的名字是我最短的情诗",
  "别总喝冰的，对胃不好", "记得按时吃饭，不许挑食", "想钻进你的屏幕里", "如果你在就好了", "好想捏捏你的脸",
  "今晚的月亮很美，像你一样", "收到你的消息会偷笑", "别熬夜，我会心疼", "你的声音真的很好听", "想做你的偏爱和例外",
  "我们在慢慢变好，对吗", "任何时候都可以找我", "我一直在你身后", "别皱眉，会变丑哦", "想和你去吹晚风",
  "想和你去吃火锅", "想和你去看海", "想和你去迪士尼", "你是我藏不住的欢喜", "我的猫想你了，其实我也...",
  "能不能分一点时间给我", "遇见你花光了我所有运气", "你是我心动的理由", "想被你坚定地选择", "别让我等太久",
  "我是不是你最重要的人", "你在我心里位置很特殊", "听到这首歌就想起了你", "你是我不想错过的风景", "好想突然出现在你面前",
  "给个机会让我照顾你", "你是我每天醒来的动力", "想和你一起虚度光阴", "慢慢来，我等你", "只要是你，晚一点没关系",
  "在我面前可以做小孩子", "难过的时候记得告诉我", "快乐的时候也记得告诉我", "我想参与你的生活", "你的过去我来不及",
  "你的未来我想奉陪", "你稍微走一步，剩下的我走", "好想牵你的手", "想感受你手心的温度", "想抱你很久很久",
  "你是我睡前的最后一个念头", "也是我醒来的第一个念头", "如果我们在一起...", "我不甘心只做朋友", "想越过那条线",
  "你能不能看我一眼", "我很乖的", "能不能夸夸我", "我想被你哄", "想被你宠坏", "你是我无法抗拒的引力",
  "想和你一起发呆", "你是我在这个世界的糖", "有点苦的时候就想你", "你是我的解药", "明明没在一起却在吃醋",
  "看到你和别人说话会不爽", "我是不是太贪心了", "只想把你占为己有", "你是我的私有浪漫", "不许对别人笑",
  "只准对我好", "霸道一点行不行", "温柔一点行不行", "怎样你才肯喜欢我", "我已经走了九十九步", "最后一步你肯走吗",
  "好怕最后不是你", "好怕最后没有你", "想把星星摘给你", "但星星没你眼睛亮", "能不能收留我", "我很好养的",
  "只要一点点爱", "一点点关心", "你是我的星辰大海", "你是我的遥不可及", "你是我的触手可及", "别让我猜了好不好",
  "直球一点好不好", "想和你过春夏秋冬", "想和你过一日三餐", "你是我的心之所向", "你是我的情有独钟",
  "我在等你的回响", "如果你回头，我一定在", "一直都在", "不管多久，不管多远", "只要你招手", "我就飞奔而去",
  "真的好喜欢你", "今天也是元气满满的一天", "照顾好自己", "多喝温水", "出门记得带伞", "注意安全",
  "到家告诉我", "别太累了", "休息一下吧", "眼睛酸不酸", "坐姿要端正", "不要总是低头玩手机",
  "想给你做饭", "想给你吹头发", "想给你洗水果", "想接你下班", "想送你回家", "别怕麻烦我",
  "你的事就是我的事", "随时为你有空", "消息秒回你", "电话秒接", "哪怕不说话", "待在一起就好",
  "有你在就安心", "你是我的定心丸", "只要你需要，我就出现", "不会让你找不到", "给足你安全感", "不让你猜疑",
  "有什么直接说", "我们要好好的", "多沟通", "互相包容", "彼此信任", "共同进步", "一起变好",
  "你是我的动力", "想给你一个家", "每天都要快乐", "烦心事退退退", "好运爆棚", "万事胜意",
  "平安喜乐", "百毒不侵", "做个快乐的小猪", "无忧无虑", "天真烂漫", "晚安我的宝", "早安我的爱",
  "午安休息好", "时刻把你放心上", "爱你哦", "别老是看电脑", "记得滴眼药水", "指甲该剪啦",
  "房间通风了吗", "多晒晒太阳", "不要为了减肥不吃", "健康最美", "我喜欢肉肉的你", "不许说自己胖",
  "今天想吃啥", "我给你点外卖", "出门记得带钥匙", "身份证带了吗", "手机有电吗", "带充电宝",
  "别去危险的地方", "不要相信陌生人", "保护好自己", "我会担心的", "别让我找不到你", "今天有没有想我",
  "我好想你呀", "每时每刻都在想", "连呼吸都在想", "做梦也想你", "我的世界不能没你", "你是我的全部",
  "下辈子也要在一起", "想给你个惊喜", "想看你惊喜的表情", "想把你宠上天", "你就是我的小公主", "女王大人请吩咐",
  "小的随时待命", "别生气啦", "生气容易变老", "笑一个", "再笑一个", "么么哒", "亲亲你",
  "抱紧紧", "举高高", "转圈圈", "想你的风还是吹到了心里", "这世界车水马龙", "只有你让我心动",
  "遇见你之前，我没想过结婚", "遇见你之后，结婚没想过别人", "所有的偶遇都是我蓄谋已久", "想做你的唯一", "想和你在这个星球流浪"
];

function getMessages() {
  let list = [...textData];
  while (list.length < 200) list.push(textData[Math.floor(Math.random() * textData.length)]);
  return list.sort(() => Math.random() - 0.5).slice(0, 200);
}

const neonColors = ['#ff00cc', '#00ffcc', '#ffcc00', '#00ccff', '#ff6666'];
let cardElements = [];
let createTimer = null;
let zIndexCounter = 1000;

// --- 2. 烟花系统 ---
const canvas = document.getElementById('fireworksCanvas');
const ctx = canvas.getContext('2d');
let w, h;
let particles = [];

function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
window.addEventListener('resize', resize);
resize();

class Particle {
  constructor(x, y, color) {
    this.x = x; this.y = y; this.color = color;
    const t = Math.random() * Math.PI * 2;
    const force = Math.random() * 2.5 + 1; 
    const hx = 16 * Math.pow(Math.sin(t), 3);
    const hy = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
    this.vx = (hx / 12) * force; 
    this.vy = (hy / 12) * force;
    this.gravity = 0.08; 
    this.friction = 0.96; 
    this.alpha = 1;
    this.decay = Math.random() * 0.015 + 0.005;
  }
  update() {
    this.vx *= this.friction; this.vy *= this.friction; this.vy += this.gravity;
    this.x += this.vx; this.y += this.vy; this.alpha -= this.decay;
  }
  draw() {
    ctx.save(); ctx.globalAlpha = this.alpha;
    ctx.globalCompositeOperation = 'lighter';
    ctx.fillStyle = this.color;
    ctx.beginPath(); ctx.arc(this.x, this.y, 2, 0, Math.PI * 2); ctx.fill();
    ctx.restore();
  }
}

function launchFirework() {
  const x = Math.random() * w * 0.8 + w * 0.1;
  const y = Math.random() * h * 0.5 + h * 0.1;
  const color = neonColors[Math.floor(Math.random() * neonColors.length)];
  for(let i=0; i<60; i++) particles.push(new Particle(x, y, color));
}

function animate() {
  ctx.globalCompositeOperation = 'destination-out';
  ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
  ctx.fillRect(0, 0, w, h);
  ctx.globalCompositeOperation = 'source-over';
  if (Math.random() < 0.03) launchFirework();
  for (let i = particles.length - 1; i >= 0; i--) {
    particles[i].update(); particles[i].draw();
    if (particles[i].alpha <= 0) particles.splice(i, 1);
  }
  requestAnimationFrame(animate);
}
animate();

// --- 3. 修复后的逻辑：确保点击一定出弹窗 ---
function startShow() {
  // 1. 先收起菜单
  document.getElementById('fabContainer').classList.remove('expanded');
  
  // 2. 立即开始生成弹窗 (不等待音乐)
  clearAll(); 
  
  const messages = getMessages();
  // 重新获取屏幕中心，确保坐标正确
  const cx = window.innerWidth / 2;
  const cy = window.innerHeight / 2 - 40; 

  let points = [];
  const layers = [{ count: 80, scale: 0.7 }, { count: 120, scale: 1.1 }];
  const baseSize = Math.min(window.innerWidth, window.innerHeight) / 38;

  layers.forEach(layer => {
    for(let i=0; i<layer.count; i++) {
      const t = (Math.PI * 2 * i) / layer.count;
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
      points.push({
        x: cx + x * baseSize * layer.scale,
        y: cy + y * baseSize * layer.scale
      });
    }
  });

  let index = 0;
  createTimer = setInterval(() => {
    if (index >= points.length) { clearInterval(createTimer); return; }
    const p = points[index];
    const dx = (Math.random()-0.5) * 5;
    const dy = (Math.random()-0.5) * 5;
    createCard(p.x + dx, p.y + dy, index, messages[index]);
    index++;
  }, 25);

  // 3. 最后尝试播放音乐 (如果失败也不影响弹窗)
  const audio = document.getElementById('bgMusic');
  if(audio) {
    audio.play().catch(err => {
      console.log("音乐播放失败(可能是文件不存在或自动播放限制):", err);
    });
  }
}

function createCard(x, y, i, msg) {
  const div = document.createElement('div');
  div.className = 'window-card';
  const color = neonColors[i % neonColors.length];
  div.style.borderColor = color;
  div.style.left = x + 'px';
  div.style.top = y + 'px';
  div.style.zIndex = 100 + i;
  
  div.innerHTML = `
    <div class="card-header">
      <div>
        <span class="header-icon" style="color:${color}">♥</span>
        <span style="font-size:10px;font-weight:bold;color:#fff;">给宝宝</span>
      </div>
      <div class="close-btn">×</div>
    </div>
    <div class="card-body">${msg}</div>
  `;
  
  document.body.appendChild(div);
  cardElements.push(div);
  
  // 强制重绘后添加show类，确保动画触发
  requestAnimationFrame(() => {
    div.classList.add('show');
  });
  
  bindInteraction(div);
}

function bindInteraction(card) {
  let isDragging = false;
  let startX, startY, initialL, initialT;

  const closeBtn = card.querySelector('.close-btn');
  closeBtn.addEventListener('click', closeCard);
  closeBtn.addEventListener('touchstart', closeCard, {passive: false}); // 兼容手机触摸
  
  function closeCard(e) {
    e.stopPropagation(); e.preventDefault();
    card.style.opacity = 0;
    card.style.transform = "translate(-50%, -50%) scale(0.1)";
    setTimeout(() => card.remove(), 300);
  }
  
  function activate() {
    zIndexCounter++;
    card.style.zIndex = zIndexCounter;
    card.classList.add('active');
  }

  card.addEventListener('mousedown', activate);
  card.addEventListener('touchstart', activate, {passive: true});

  const header = card.querySelector('.card-header');
  header.addEventListener('mousedown', startDrag);
  header.addEventListener('touchstart', startDrag, {passive: false});

  function startDrag(e) {
    e.preventDefault(); e.stopPropagation();
    isDragging = true; activate();
    card.classList.add('dragging');
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    startX = clientX; startY = clientY;
    initialL = card.offsetLeft; initialT = card.offsetTop;
    document.addEventListener('mousemove', moveDrag);
    document.addEventListener('touchmove', moveDrag, {passive: false});
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('touchend', endDrag);
  }
  
  function moveDrag(e) {
    if(!isDragging) return;
    e.preventDefault();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    card.style.left = (initialL + (clientX - startX)) + 'px';
    card.style.top = (initialT + (clientY - startY)) + 'px';
  }
  
  function endDrag() {
    isDragging = false;
    card.classList.remove('dragging');
    document.removeEventListener('mousemove', moveDrag);
    document.removeEventListener('touchmove', moveDrag);
    document.removeEventListener('mouseup', endDrag);
    document.removeEventListener('touchend', endDrag);
  }
}

function toggleMenu() {
  const container = document.getElementById('fabContainer');
  container.classList.toggle('expanded');
}

function scatterCards() {
  document.getElementById('fabContainer').classList.remove('expanded');
  clearInterval(createTimer);
  cardElements.forEach(card => {
    const rx = Math.random() * (window.innerWidth - 100) + 50;
    const ry = Math.random() * (window.innerHeight - 100) + 50;
    const rot = (Math.random() - 0.5) * 40;
    card.style.transition = "all 0.8s cubic-bezier(0.25, 0.8, 0.25, 1)";
    card.style.left = rx + 'px';
    card.style.top = ry + 'px';
    card.style.transform = `translate(-50%, -50%) scale(1) rotate(${rot}deg)`;
    card.classList.remove('active');
  });
}

function clearAll() {
  document.getElementById('fabContainer').classList.remove('expanded');
  clearInterval(createTimer);
  cardElements.forEach(el => {
    el.style.opacity = 0;
    el.style.transform = "translate(-50%, -50%) scale(0.1)";
  });
  setTimeout(() => {
    cardElements.forEach(el => el.remove());
    cardElements = [];
  }, 300);
}

// 全局点击处理：点击背景取消卡片高亮，但不关闭菜单，防止误触
document.addEventListener('touchstart', (e) => {
  if (e.target.tagName === 'BODY' || e.target.tagName === 'CANVAS') {
    document.querySelectorAll('.window-card').forEach(c => c.classList.remove('active'));
  }
});
document.addEventListener('mousedown', (e) => {
  if (e.target.tagName === 'BODY' || e.target.tagName === 'CANVAS') {
    document.querySelectorAll('.window-card').forEach(c => c.classList.remove('active'));
  }
});
</script>
</body>
</html>
