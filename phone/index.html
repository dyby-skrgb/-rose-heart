<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>给宝宝的小情书(◕ᴗ◕✿)</title>
<style>
  /* --- 1. 全局设置 --- */
  * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body {
    width: 100vw; height: 100vh; overflow: hidden;
    /* 深邃星空背景 */
    background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
    font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
    position: relative;
    user-select: none; /* 禁止选中文字 */
  }

  /* --- 2. 烟花画布 --- */
  #fireworksCanvas {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    z-index: 1; pointer-events: none;
  }

  /* --- 3. 弹窗卡片 (霓虹玻璃质感) --- */
  .window-card {
    position: fixed;
    width: 115px; /* 手机适配宽度 */
    background: rgba(20, 20, 25, 0.85);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1.5px solid rgba(255,255,255,0.3);
    border-radius: 12px;
    opacity: 0;
    transform: translate(-50%, -50%) scale(0.1);
    /* 出现动画 */
    transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s;
    z-index: 10;
    display: flex; flex-direction: column;
    box-shadow: 0 4px 20px rgba(0,0,0,0.6);
    overflow: hidden;
  }

  .card-header {
    height: 24px;
    background: rgba(255,255,255,0.1);
    display: flex; justify-content: space-between; align-items: center;
    padding: 0 8px; border-bottom: 1px solid rgba(255,255,255,0.1);
  }

  .header-icon { font-size: 10px; margin-right: 4px; }
  .close-btn { font-size: 14px; color: rgba(255,255,255,0.6); cursor: pointer; }

  .card-body {
    padding: 10px; font-size: 11px; color: #eee;
    line-height: 1.5; text-align: left;
    min-height: 45px; display: flex; align-items: center;
  }

  /* 激活状态 */
  .window-card.active {
    z-index: 99999 !important;
    transform: translate(-50%, -50%) scale(1.5) !important;
    background: rgba(10,10,10,0.95);
    box-shadow: 0 10px 40px rgba(0,0,0,0.8);
  }

  /* --- 4. 底部控制按钮组 (复刻你的截图) --- */
  .controls-container {
    position: fixed;
    bottom: 80px; left: 50%;
    transform: translateX(-50%);
    display: flex; gap: 15px;
    z-index: 20000;
    opacity: 0; pointer-events: none;
    transition: all 0.5s;
    transform-origin: bottom center;
  }
  
  .controls-container.show {
    opacity: 1; pointer-events: auto;
    transform: translateX(-50%) translateY(0);
  }

  /* 按钮样式：圆角矩形 + 霓虹边框 */
  .action-btn {
    width: 55px; height: 55px;
    border-radius: 14px;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    border: 2px solid;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    color: #fff; font-size: 10px; font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    transition: transform 0.1s;
  }
  .action-btn:active { transform: scale(0.95); }
  
  .btn-icon { font-size: 20px; margin-bottom: 2px; }

  /* 颜色定制 */
  .btn-start { border-color: #00ffcc; color: #00ffcc; text-shadow: 0 0 5px #00ffcc; } /* 青色 */
  .btn-scatter { border-color: #ffaa00; color: #ffaa00; text-shadow: 0 0 5px #ffaa00; } /* 橙色 */
  .btn-clear { border-color: #ff4444; color: #ff4444; text-shadow: 0 0 5px #ff4444; } /* 红色 */

  /* --- 5. 悬浮爱心开关 --- */
  .heart-trigger {
    position: fixed; bottom: 30px; left: 50%;
    transform: translateX(-50%);
    width: 50px; height: 50px;
    background: linear-gradient(135deg, #ff9a9e 0%, #ff6a88 100%);
    border-radius: 50%;
    display: flex; justify-content: center; align-items: center;
    color: #fff; font-size: 24px;
    box-shadow: 0 0 20px rgba(255, 106, 136, 0.6);
    z-index: 20001; cursor: pointer;
    border: 2px solid #fff;
    animation: pulse 1.5s infinite;
  }
  @keyframes pulse { 0% {transform:translateX(-50%) scale(1);} 50% {transform:translateX(-50%) scale(1.1);} 100% {transform:translateX(-50%) scale(1);} }

</style>
</head>
<body>

<!-- 烟花背景 -->
<canvas id="fireworksCanvas"></canvas>

<!-- 音乐：在线温馨钢琴曲 (River Flows In You) -->
<audio id="bgMusic" loop>
  <!-- 使用网易云音乐外链，确保无需下载文件 -->
  <source src="https://music.163.com/song/media/outer/url?id=26237342.mp3" type="audio/mpeg">
</audio>

<!-- 按钮组 -->
<div class="controls-container" id="controls">
  <div class="action-btn btn-start" onclick="startShow()">
    <span class="btn-icon">▶</span>
    <span>开始</span>
  </div>
  <div class="action-btn btn-scatter" onclick="scatterCards()">
    <span class="btn-icon">✨</span>
    <span>散落</span>
  </div>
  <div class="action-btn btn-clear" onclick="clearAll()">
    <span class="btn-icon">×</span>
    <span>清除</span>
  </div>
</div>

<!-- 悬浮开关 -->
<div class="heart-trigger" onclick="toggleMenu()">❤</div>

<script>
/**
 * 1. 文案库
 */
const textData = [
  "慢慢的习惯身边有你的温暖", "晚安，梦里见", "今天有没有一点点想我", "天气凉了，记得加衣", 
  "不仅要早睡，还要睡得香", "想和你分享今天的趣事", "你现在的表情是不是很可爱", 
  "你的名字是我最短的情诗", "别总喝冰的，对胃不好", "记得按时吃饭", "想钻进你的屏幕里", 
  "如果你在就好了", "好想捏捏你的脸", "今晚的月亮很美，像你一样", "收到你的消息会偷笑", 
  "别熬夜，我会心疼", "想做你的偏爱和例外", "我们慢慢变好", "任何时候都可以找我", 
  "我一直在你身后", "别皱眉，会变丑哦", "想和你去吹晚风", "想和你去吃火锅", "想和你去看海", 
  "你是我藏不住的欢喜", "我的猫想你了", "遇见你花光了我所有运气", "你是我心动的理由", 
  "想被你坚定地选择", "别让我等太久", "你在我心里位置很特殊", "听到这首歌就想起了你", 
  "你是我不想错过的风景", "好想突然出现在你面前", "给个机会让我照顾你", "你是我每天醒来的动力", 
  "想和你一起虚度光阴", "慢慢来，我等你", "只要是你，晚一点没关系", "在我面前可以做小孩子", 
  "难过的时候记得告诉我", "快乐的时候也记得告诉我", "我想参与你的生活", "你的未来我想奉陪", 
  "好想牵你的手", "想感受你手心的温度", "想抱你很久很久", "你是我睡前的最后一个念头", 
  "我不甘心只做朋友", "想越过那条线", "你能不能看我一眼", "我很乖的", "能不能夸夸我", 
  "我想被你哄", "想被你宠坏", "你是我无法抗拒的引力", "想和你一起发呆", "你是我在这个世界的糖", 
  "有点苦的时候就想你", "你是我的解药", "看到你和别人说话会不爽", "我是不是太贪心了", 
  "只想把你占为己有", "你是我的私有浪漫", "只准对我好", "霸道一点行不行", "温柔一点行不行", 
  "我已经走了九十九步", "最后一步你肯走吗", "好怕最后不是你", "好怕最后没有你", "想把星星摘给你", 
  "能不能收留我", "我很好养的", "只要一点点爱", "你是我的星辰大海", "你是我的遥不可及", 
  "别让我猜了好不好", "想和你过春夏秋冬", "想和你过一日三餐", "你是我的心之所向", 
  "我在等你的回响", "如果你回头，我一定在", "不管多久，不管多远", "只要你招手", "我就飞奔而去", 
  "真的好喜欢你", "照顾好自己", "多喝温水", "出门记得带伞", "注意安全", "到家告诉我", 
  "别太累了", "休息一下吧", "眼睛酸不酸", "不要总是低头玩手机", "想给你做饭", "想给你吹头发", 
  "想接你下班", "想送你回家", "你的事就是我的事", "随时为你有空", "消息秒回你", "有你在就安心", 
  "你是我的定心丸", "不会让你找不到", "给足你安全感", "不让你猜疑", "我们要好好的", 
  "互相包容", "彼此信任", "一起变好", "你是我的动力", "每天都要快乐", "烦心事退退退", 
  "好运爆棚", "万事胜意", "晚安我的宝", "早安我的爱", "时刻把你放心上", "爱你哦", 
  "别老是看电脑", "记得滴眼药水", "多晒晒太阳", "不要为了减肥不吃", "健康最美", 
  "不许说自己胖", "今天想吃啥", "我给你点外卖", "出门记得带钥匙", "身份证带了吗", 
  "手机有电吗", "别去危险的地方", "我会担心的", "别让我找不到你", "今天有没有想我", 
  "我好想你呀", "每时每刻都在想", "连呼吸都在想", "做梦也想你", "我的世界不能没你", 
  "你是我的全部", "下辈子也要在一起", "想给你个惊喜", "你是我的小公主", "别生气啦", 
  "笑一个", "再笑一个", "么么哒", "亲亲你", "抱紧紧", "举高高", "想你的风还是吹到了心里", 
  "这世界车水马龙", "只有你让我心动", "遇见你之前，我没想过结婚", "想和你流浪", 
  "想和你在这个星球虚度", "生活会有光的", "我们都要好好的"
];

function getMessages() {
  let list = [...textData];
  while (list.length < 200) list.push(textData[Math.floor(Math.random() * textData.length)]);
  return list.sort(() => Math.random() - 0.5).slice(0, 200);
}

/**
 * 2. 3D 心形烟花
 */
const canvas = document.getElementById('fireworksCanvas');
const ctx = canvas.getContext('2d');
let w, h;
let particles = [];

function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
window.addEventListener('resize', resize);
resize();

class Particle {
  constructor(x, y, color) {
    this.x = x; this.y = y; this.color = color;
    const t = Math.random() * Math.PI * 2;
    const force = Math.random() * 2.5 + 1;
    // 心形扩散
    const vx = 16 * Math.pow(Math.sin(t), 3);
    const vy = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
    this.vx = (vx / 15) * force;
    this.vy = (vy / 15) * force;
    this.gravity = 0.08; this.alpha = 1; this.decay = Math.random() * 0.015 + 0.005;
  }
  update() {
    this.vx *= 0.96; this.vy *= 0.96; this.vy += this.gravity;
    this.x += this.vx; this.y += this.vy; this.alpha -= this.decay;
  }
  draw() {
    ctx.globalAlpha = this.alpha; ctx.globalCompositeOperation = 'lighter';
    ctx.fillStyle = this.color;
    ctx.beginPath(); ctx.arc(this.x, this.y, 2, 0, Math.PI * 2); ctx.fill();
  }
}

function animateFireworks() {
  ctx.globalCompositeOperation = 'destination-out';
  ctx.fillStyle = 'rgba(0, 0, 0, 0.15)'; ctx.fillRect(0, 0, w, h);
  
  if (Math.random() < 0.04) {
    const x = Math.random() * w; const y = Math.random() * h * 0.5;
    const color = `hsl(${Math.random()*360}, 100%, 70%)`;
    for(let i=0; i<40; i++) particles.push(new Particle(x, y, color));
  }
  
  for (let i = particles.length - 1; i >= 0; i--) {
    particles[i].update(); particles[i].draw();
    if (particles[i].alpha <= 0) particles.splice(i, 1);
  }
  requestAnimationFrame(animateFireworks);
}
animateFireworks();


/**
 * 3. 核心交互
 */
const neonColors = ['#ff00cc', '#00ffcc', '#ffcc00', '#00ccff', '#ff6666'];
let cardElements = [];
let createTimer = null;
let zIndexCounter = 1000;

function toggleMenu() {
  document.getElementById('controls').classList.toggle('show');
}

function startShow() {
  // 核心修复：即使音乐加载失败，动画也要继续运行
  const audio = document.getElementById('bgMusic');
  // 尝试播放，无论成功失败都忽略错误，继续执行
  const playPromise = audio.play();
  if (playPromise !== undefined) {
    playPromise.catch(error => {
      console.log("音频自动播放被拦截，需要用户交互，但动画会正常开始。");
    });
  }

  // 隐藏菜单
  document.getElementById('controls').classList.remove('show');
  
  clearAll(false); // 不重复清除菜单

  const messages = getMessages();
  const cx = w / 2;
  const cy = h / 2 - 50;
  let points = [];
  
  // 双轨爱心生成坐标
  const layers = [{ count: 70, scale: 0.6 }, { count: 100, scale: 1.0 }];
  layers.forEach(layer => {
    for(let i=0; i<layer.count; i++) {
      const t = (Math.PI * 2 * i) / layer.count;
      const x = 16 * Math.pow(Math.sin(t), 3);
      const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
      // 适配手机屏幕的缩放系数 (15-20之间)
      const zoom = (w < 500 ? 14 : 20) * layer.scale;
      points.push({ x: cx + x * zoom, y: cy + y * zoom });
    }
  });

  let index = 0;
  createTimer = setInterval(() => {
    if (index >= points.length) { clearInterval(createTimer); return; }
    const p = points[index];
    // 加一点随机偏移，看起来更自然
    createCard(p.x + (Math.random()-0.5)*5, p.y + (Math.random()-0.5)*5, index, messages[index]);
    index++;
  }, 30);
}

function createCard(x, y, i, msg) {
  const div = document.createElement('div');
  div.className = 'window-card';
  div.style.left = x + 'px';
  div.style.top = y + 'px';
  div.style.zIndex = 100 + i;
  div.style.borderColor = neonColors[i % neonColors.length]; // 炫彩边框
  
  div.innerHTML = `
    <div class="card-header">
      <div>
        <span class="header-icon" style="color:${div.style.borderColor}">♥</span>
        <span style="font-weight:bold;color:#fff;">给宝宝</span>
      </div>
      <div class="close-btn">×</div>
    </div>
    <div class="card-body">${msg}</div>
  `;
  
  // 绑定交互
  bindInteraction(div);
  document.body.appendChild(div);
  cardElements.push(div);
  
  requestAnimationFrame(() => div.style.opacity = 1);
}

function bindInteraction(card) {
  // 1. 关闭
  const closeBtn = card.querySelector('.close-btn');
  closeBtn.onclick = (e) => {
    e.stopPropagation();
    card.style.opacity = 0;
    setTimeout(() => card.remove(), 300);
  };

  // 2. 点击置顶放大
  const activate = () => {
    zIndexCounter++;
    card.style.zIndex = zIndexCounter;
    card.classList.add('active');
  };
  card.addEventListener('mousedown', activate);
  card.addEventListener('touchstart', activate, {passive: true});

  // 3. 拖拽 (兼容手机和电脑)
  let isDragging = false;
  let startX, startY, initLeft, initTop;

  const startDrag = (e) => {
    isDragging = true;
    activate();
    const point = e.touches ? e.touches[0] : e;
    startX = point.clientX;
    startY = point.clientY;
    initLeft = card.offsetLeft;
    initTop = card.offsetTop;
  };

  const onDrag = (e) => {
    if (!isDragging) return;
    e.preventDefault(); // 防止手机滚动
    const point = e.touches ? e.touches[0] : e;
    const dx = point.clientX - startX;
    const dy = point.clientY - startY;
    card.style.left = (initLeft + dx) + 'px';
    card.style.top = (initTop + dy) + 'px';
  };

  const stopDrag = () => { isDragging = false; };

  const header = card.querySelector('.card-header');
  header.addEventListener('mousedown', startDrag);
  header.addEventListener('touchstart', startDrag, {passive: false});
  
  document.addEventListener('mousemove', onDrag);
  document.addEventListener('touchmove', onDrag, {passive: false});
  
  document.addEventListener('mouseup', stopDrag);
  document.addEventListener('touchend', stopDrag);
}

function scatterCards() {
  document.getElementById('controls').classList.remove('show');
  clearInterval(createTimer);
  cardElements.forEach(card => {
    const rx = Math.random() * (w - 100) + 50;
    const ry = Math.random() * (h - 100) + 50;
    const rot = (Math.random() - 0.5) * 60;
    card.style.transition = "all 0.8s cubic-bezier(0.25, 0.8, 0.25, 1)";
    card.style.left = rx + 'px';
    card.style.top = ry + 'px';
    card.style.transform = `translate(-50%, -50%) rotate(${rot}deg)`;
    card.classList.remove('active');
  });
}

function clearAll(hideMenu = true) {
  if(hideMenu) document.getElementById('controls').classList.remove('show');
  clearInterval(createTimer);
  cardElements.forEach(el => {
    el.style.opacity = 0;
    el.style.transform = "translate(-50%, -50%) scale(0.1)";
  });
  setTimeout(() => {
    cardElements.forEach(el => el.remove());
    cardElements = [];
  }, 300);
}

// 点击背景取消高亮
document.addEventListener('touchstart', (e) => {
  if (e.target.tagName === 'BODY' || e.target.tagName === 'CANVAS') {
    document.querySelectorAll('.window-card').forEach(c => c.classList.remove('active'));
  }
});

</script>
</body>
</html>
